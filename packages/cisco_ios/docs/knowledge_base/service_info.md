# Service Info

## Common use cases

The Cisco IOS integration provides comprehensive visibility into the operational health and security posture of Cisco networking equipment by centralizing system logs (syslog) within the Elastic Stack.
- **Security Auditing and Compliance:** Monitor administrative access, including successful and failed login attempts, as well as configuration changes made through the CLI to maintain a secure audit trail.
- **Network Troubleshooting:** Rapidly identify and resolve connectivity issues by analyzing interface state changes (up/down events), routing protocol flapping, and hardware alerts.
- **Operational Performance Monitoring:** Track system-level resource warnings such as high CPU utilization, memory exhaustion, and buffer overflows that could impact network throughput.
- **Incident Response:** Use centralized Cisco logs to correlate network activity with endpoint and cloud events during security investigations to trace the lateral movement of threats.

## Data types collected

This integration can collect the following types of data:
- **System Logs:** Operational events such as system startups, reboots, and configuration changes generated by the Cisco IOS operating system.
- **Security Logs:** Authentication attempts (AAA), access control list (ACL) hits, and SSH/Telnet session activity.
- **Interface Logs:** Status updates regarding physical and logical interfaces, including "up/down" transitions and line protocol changes.
- **Protocol Logs:** Events related to routing protocols such as OSPF, BGP, and EIGRP, as well as spanning-tree (STP) changes.
- **Data Format:** Standard Syslog format (RFC 3164 or RFC 5424) typically transmitted via UDP or TCP.
- **Metrics (via logs):** Indirect metrics extracted from log messages, such as error counts, temperature warnings, and fan failures.

## Compatibility

This integration supports **Cisco IOS** and **Cisco IOS XE** software versions. It has been specifically validated with **Cisco IOS XE 17.x** versions (such as 17.17 and 17.18) on Catalyst platforms.

## Scaling and Performance

- **Transport/Collection Considerations:** Cisco IOS defaults to sending syslog over UDP on port 514. While UDP offers lower overhead and higher throughput for the network device, it is "fire and forget" and lacks delivery guarantees. In high-congestion environments where log integrity is critical, consider using TCP if the specific IOS version and hardware support it to ensure no logs are dropped during transit.
- **Data Volume Management:** To prevent overwhelming the Elastic Agent and storage, utilize the `logging trap <level>` command on the Cisco device. Setting the level to `informational` (6) or `notifications` (5) is recommended for production environments to capture significant events while filtering out high-volume `debugging` (7) logs that can negatively impact device CPU and network bandwidth.
- **Elastic Agent Scaling:** For high-volume environments with hundreds of Cisco devices, deploy multiple Elastic Agents behind a load balancer. A single Agent can typically handle several thousand events per second (EPS), but resource utilization (CPU/RAM) should be monitored. Placing Agents geographically closer to the network core can reduce latency and potential packet loss for UDP-based syslog streams.

# Set Up Instructions

## Vendor prerequisites

- **Administrative Access:** Privileged EXEC mode (`enable`) and Global Configuration mode access on the Cisco IOS device CLI.
- **Network Connectivity:** Unrestricted network path from the Cisco device to the Elastic Agent on the configured syslog port (default is often 514).
- **Firewall Rules:** Ensure any intermediate firewalls or Access Control Lists (ACLs) allow UDP or TCP traffic on the chosen syslog port.
- **Stable Source Interface:** Identification of a stable interface (like `Loopback0`) to use as the consistent source IP for all outgoing syslog packets.
- **License Requirements:** No specific Cisco license is typically required for standard syslog functionality, though certain advanced logging features may vary by IOS version.

## Elastic prerequisites

- **Elastic Agent:** An active Elastic Agent must be installed and enrolled in a policy via Fleet.
- **Integration Policy:** The Cisco IOS integration must be added to the Agent's policy with the correct input settings (UDP/TCP port).
- **Connectivity:** The Elastic Agent host must be listening on the specified port and reachable by the Cisco devices.

## Vendor set up steps

### For Syslog Collection via CLI:

1.  **Access the device CLI**
    Connect to your Cisco device using console, Telnet, or SSH and enter Privileged EXEC mode.
    ```bash
    enable
    ```

2.  **Enter Global Configuration Mode**
    Access the configuration terminal to begin making changes.
    ```bash
    configure terminal
    ```

3.  **Configure Timestamps and Sequence Numbers**
    Ensure logs are uniquely identifiable and have high-resolution timing data for better ingestion accuracy.
    ```bash
    service timestamps debug datetime show-timezone msec
    service timestamps log datetime show-timezone msec
    service sequence-numbers
    ```

4.  **Configure the Syslog Server Host**
    Point the device to your Elastic Agent's IP address. Replace `<elastic-agent-ip>` with the actual IP address.
    ```bash
    logging host <elastic-agent-ip> transport udp port 514
    ```
    *Note: If you configured the Elastic Agent to use TCP, change `udp` to `tcp` in the command above.*

5.  **Set the Logging Severity Level**
    Define which logs are sent to the agent. `informational` (level 6) is the standard for comprehensive monitoring.
    ```bash
    logging trap informational
    ```

6.  **Specify the Source Interface**
    Force the device to use a consistent IP address (like a Loopback) so the Elastic Agent recognizes the source reliably.
    ```bash
    logging source-interface loopback0
    ```

7.  **Enable Logging**
    Activate the logging process on the device.
    ```bash
    logging on
    ```

8.  **Verify and Save the Configuration**
    Check that the logging host is correctly registered and then save the configuration to non-volatile memory.
    ```bash
    end
    show logging
    copy running-config startup-config
    ```

## Kibana set up steps

### For Cisco IOS Syslog Input:

1.  Navigate to **Management > Integrations** in Kibana and search for **Cisco IOS**.
2.  Click **Add Cisco IOS** to start the configuration wizard.
3.  Choose the **Cisco IOS Syslog** input type.
4.  Configure the **Listen Host** and **Listen Port**:
    - Set **Syslog Host** to `0.0.0.0` to listen on all available interfaces or specify the internal IP of the Agent.
    - Set **Syslog Port** to `514` (ensure this matches your Cisco `logging host` configuration).
5.  Under **Advanced options**, ensure the **Facility Filter** matches what you configured on the Cisco device (e.g., `local7`).
6.  Assign the integration to the appropriate **Agent Policy**.
7.  Click **Save and continue**, then **Roll out changes** to deploy the configuration to your Elastic Agents.

# Validation Steps

After configuration is complete, follow these steps to verify data is flowing correctly from Cisco IOS to the Elastic Stack.

### 1. Trigger Data Flow on Cisco IOS:
- **Generate configuration event:** Enter and exit configuration mode by running `configure terminal` followed by `exit`. This triggers a `SYS-5-CONFIG_I` log.
- **Trigger interface event:** On a non-production interface, perform a `shutdown` followed by `no shutdown` to generate interface status logs.
- **Generate authentication event:** Log out of your current session and log back in to generate AAA or login logs.

### 2. Check Data in Kibana:
1. Navigate to **Analytics > Discover**.
2. Select the `logs-*` data view.
3. Enter the following KQL filter: `data_stream.dataset : "cisco_ios.log"`
4. Verify logs appear in the results. Expand a log entry and confirm these fields are populated:
   - `event.dataset` (should be `cisco_ios.log`)
   - `source.ip` (should match the Cisco device IP or loopback)
   - `cisco.ios.mnemonic` (e.g., `CONFIG_I`, `UPDOWN`, or `LINK`)
   - `log.level` (e.g., `informational`, `notice`, or `error`)
   - `message` (containing the raw syslog payload from the device)
5. Navigate to **Analytics > Dashboards** and search for "Cisco IOS" to view pre-built visualizations for event trends and severity distributions.

# Troubleshooting

## Common Configuration Issues

- **Missing Timestamps**: If logs are not parsing correctly or appearing with the wrong date, ensure `service timestamps log datetime msec` is configured. Without this, Cisco IOS may omit the year or milliseconds, leading to ingestion delays or parsing failures.
- **Source IP Mismatch**: If you have multiple paths to the Elastic Agent, logs may arrive from different interface IPs. Always use `logging source-interface` to ensure a consistent IP for filtering and identification in Kibana.
- **Port Conflict**: If the Elastic Agent fails to start the syslog listener, check if another process is already using UDP port 514 on the Agent host. You may need to stop the native syslog service (rsyslog/syslog-ng) or use a different port (e.g., 9514) in both the Cisco CLI and Kibana settings.
- **ACL/Firewall Blocks**: If `show logging` on the Cisco device shows "messages logged" but nothing appears in Kibana, verify that intermediate firewalls are permitting the syslog traffic from the router's source IP to the Agent's IP.

## Ingestion Errors

- **Parsing Failures**: Check the `error.message` field in Discover. This often occurs if the Cisco log format has been customized or if an unsupported IOS version uses a non-standard header.
- **Facility Mismatch**: Ensure the facility configured in the Kibana integration (e.g., `local7`) matches the `logging facility` command on the Cisco device. Mismatched facilities can result in logs being dropped by the input filter.
- **Timezone Offsets**: If logs appear "in the future" or "in the past," verify that both the Cisco device and the Elastic Agent have synchronized clocks via NTP and that `show-timezone` is included in the timestamp configuration.

## Vendor Resources

- [System Management Configuration Guide, Cisco IOS XE 17.18.x (Catalyst 9600)](https://www.cisco.com/c/en/us/td/docs/switches/lan/catalyst9600/software/release/17-18/configuration_guide/sys_mgmt/b_1718_sys_mgmt_9600_cg/configuring_system_message_logs.html)
- [Cisco Catalyst 9800 Series Wireless Controller Software Configuration Guide, 17.17](https://www.cisco.com/c/en/us/td/docs/wireless/controller/9800/17-17/config-guide/b_wl_17_17_cg/m_syslog_server.html)

## Documentation sites

- [System Management Configuration Guide, Cisco IOS XE 17.18.x (Catalyst 9600)](https://www.cisco.com/c/en/us/td/docs/switches/lan/catalyst9600/software/release/17-18/configuration_guide/sys_mgmt/b_1718_sys_mgmt_9600_cg/configuring_system_message_logs.html)
- [Cisco Catalyst 9800 Series Wireless Controller Software Configuration Guide, 17.17](https://www.cisco.com/c/en/us/td/docs/wireless/controller/9800/17-17/config-guide/b_wl_17_17_cg/m_syslog_server.html)
