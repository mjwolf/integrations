# Service Info

Endace appliances provide high-speed packet capture and network recording, utilizing the Suricata detection engine to generate deep-packet security events. This integration enables organizations to ingest these high-fidelity security alerts and network metadata into the Elastic Stack for advanced threat hunting, long-term forensic analysis, and centralized security operations.

## Common use cases

- **Network Threat Detection:** Monitor Endace Suricata alerts in real-time within Kibana to identify known malicious patterns, malware command-and-control traffic, and exploit attempts across high-speed links.
- **Protocol Analysis and Visibility:** Use collected HTTP, DNS, and TLS metadata to gain deep visibility into network traffic patterns, identifying unauthorized application usage or shadow IT within the environment.
- **Security Incident Forensics:** Pivot from Elastic dashboards to Endace's packet-level recordings by using the timestamp and flow information captured in the Suricata logs for rapid root-cause analysis.
- **Compliance and Audit Logging:** Maintain a long-term, searchable repository of all network flow and anomaly events generated by Endace probes to meet regulatory requirements for network monitoring and data retention.

## Data types collected

This integration can collect the following types of data:
- **Security Alerts:** Detailed logs from the Suricata engine identifying potential threats based on signature matching.
- **Network Metadata:** Protocol-specific information including HTTP request/response headers, DNS queries and answers, and TLS handshake details (SNI, certificates).
- **Flow Logs:** Records of network sessions including source/destination IPs, ports, protocols, and byte/packet counts.
- **Anomaly Logs:** Detection of protocol violations or unusual network behavior flagged by the Suricata engine.
- **Format:** All data is captured in the Suricata EVE (Extensible Event Format) JSON format and transmitted via Syslog.
- **System Information:** Identity tags and facility codes used to categorize the origin of the network events.

## Compatibility

The **Endace** integration is compatible with Endace appliances running **Endace OSm version 6.0 and higher** that support the integrated Suricata engine. The integration expects Suricata version 5.x or 7.x output formats transmitted via standard Syslog protocols (UDP or TCP).

## Scaling and Performance

- **Transport/Collection Considerations:** When choosing between UDP and TCP for log forwarding, consider that TCP ensures delivery and is recommended for high-security environments where log integrity is paramount. However, for extremely high-volume network links, UDP may be preferred to avoid backpressure on the Endace appliance, though it may result in packet loss during network congestion.
- **Data Volume Management:** Suricata can generate massive amounts of data; it is highly recommended to filter event types at the source within the `suricata.yaml` file. Limit collection to essential types like `alert` and `dns` initially, adding `flow` or `http` only if the Elastic environment is sized to handle the increased ingestion rate.
- **Elastic Agent Scaling:** For high-throughput Endace probes, a single Elastic Agent may become a bottleneck. Deploy multiple Elastic Agents behind a load balancer or utilize a dedicated high-performance host for the Agent receiving syslog data. Ensure the host has sufficient CPU cores to handle the multi-threaded processing of JSON parsing.

# Set Up Instructions

## Vendor prerequisites

- **Administrative Access:** You must have root-level or administrative access to the EndaceProbe CLI or Web Management Interface to configure logging settings.
- **Network Connectivity:** Ensure that the Endace appliance can reach the Elastic Agent host on the configured port (e.g., UDP/TCP 514 or a custom port like 9514).
- **Firewall Rules:** Update any intermediate firewalls or Access Control Lists (ACLs) to allow traffic between the appliance and the Agent.
- **License Requirements:** Verify that your Endace OES license includes support for remote syslog forwarding or log export features.
- **Device Information:** Have the IP address of the Elastic Agent and the preferred transport protocol (TCP/UDP) ready before starting the configuration.

## Elastic prerequisites

- **Elastic Agent:** An Elastic Agent must be installed and enrolled in a policy via Fleet.
- **Integration Package:** The "Endace" integration must be added to the Agent policy.
- **Connectivity:** The Elastic Agent must be reachable over the network by the Endace appliance on the port specified in the integration settings.

## Vendor set up steps

Configuring external logging for Endace appliances is performed via the OSm (Operating System for Monitoring) software. Follow these steps to configure syslog forwarding:

### For Syslog Collection (Web GUI):
1. Log in to the **Endace OSm web administration interface** on your EndaceProbe or appliance.
2. Navigate to the system administration section by clicking on **Settings** or **Administration** in the main menu.
3. Locate the **Notifications** or **Syslog** configuration menu. This is often found under a **System** or **Monitoring** sub-header.
4. Click the button to **Add a New Notification Target** or **Syslog Server**.
5. In the **Server IP / Hostname** field, enter the IP address of the server where your Elastic Agent is running.
6. Set the **Port** number to match your Elastic Agent's input configuration (e.g., `9002` for TCP or `9001` for UDP).
7. Select the **Protocol** (TCP or UDP). It is highly recommended to use **TCP** for reliable log delivery.
8. Choose the **Format** for the logs. Select **RFC 5424** if available, as it provides better structure for modern log parsers; otherwise, select **RFC 3164**.
9. In the **Event Selection** or **Severity** list, check the boxes for the types of events you want to forward (e.g., System Alarms, Hardware Status, Performance).
10. Click **Save** and then click **Apply Configuration** to start the log transmission.

### For Syslog Collection (CLI):
1. Connect to the Endace appliance via SSH using an account with administrative privileges.
2. Enter the configuration mode of the OSm CLI (consult vendor documentation for the specific `config` command).
3. Use the `notification` or `logging` command strings to define a new remote syslog host.
4. Specify the target IP, port number, and protocol (TCP/UDP) as part of the command syntax.
5. Define the logging levels (e.g., `level warning`) to restrict the volume of data sent.
6. Commit the changes and exit the configuration mode.

## Kibana set up steps

### Configure Endace Integration:

1. In Kibana, navigate to **Management > Integrations**.
2. Search for **Endace** and click on the integration tile.
3. Click **Add Endace**.
4. Select the desired **Input type** (e.g., "UDP", "TCP", or "Log file").
5. If using Syslog (UDP/TCP):
    - Set the **Syslog Host** to `0.0.0.0` to listen on all interfaces or provide a specific IP address.
    - Set the **Syslog Port** to the value decided during the vendor setup (e.g., `9514`).
6. If using Log file:
    - In the **Paths** field, enter the full path to the Endace log files (e.g., `/var/log/endace/*.log`).
7. Expand **Advanced options** if you need to adjust internal timeouts or custom tags.
8. Click **Save and continue** to add the integration to your Agent policy.
9. Click **Save and deploy changes** to push the configuration to the enrolled Elastic Agents.

# Validation Steps

After configuration is complete, follow these steps to verify data is flowing correctly from Endace to the Elastic Stack.

### 1. Trigger Data Flow on Endace:
- **Generate Alert Traffic:** From a host on the network being monitored by the Endace probe, attempt to resolve a known "suspicious" domain or use a tool like `curl` to access a test URL that triggers a Suricata signature (e.g., `curl http://testmynids.com/uid/index.html`).
- **Generate Network Metadata:** Browse multiple encrypted (HTTPS) and unencrypted (HTTP) websites through the monitored link to generate TLS and HTTP metadata events.
- **Restart Services:** Perform a `sudo systemctl restart suricata` on the Endace appliance; this usually generates a startup/log event that will be forwarded to the Agent.

### 2. Check Data in Kibana:
1. Navigate to **Analytics > Discover**.
2. Select the `logs-*` data view.
3. Enter the following KQL filter: `data_stream.dataset : "endace.log"`
4. Verify logs appear in the results. Expand a log entry and confirm these fields are populated:
   - `event.dataset` (should be `endace.log`)
   - `source.ip` and `destination.ip` (representing the network traffic captured)
   - `event.action` (e.g., `allowed` or `blocked` for alerts)
   - `suricata.eve.alert.signature` (the name of the detection rule triggered)
   - `message` (containing the raw JSON payload from Suricata)
5. Navigate to **Analytics > Dashboards** and search for "Endace" to view the pre-built dashboards and ensure visualizations are populating.

# Troubleshooting

## Common Configuration Issues

- **Port Conflict**: If logs are not appearing, ensure that the port assigned (e.g., 9514) is not being used by another process on the Elastic Agent host. Use `netstat -tunlp | grep <port>` on Linux to check for conflicts.
- **Firewall Obstruction**: Verify that the local firewall on the Elastic Agent host (e.g., `iptables` or `firewalld`) is configured to allow incoming traffic on the specified TCP/UDP port.
- **Mismatch in Protocol**: Ensure that if the Endace appliance is configured to send via TCP, the Kibana integration is also set to TCP. A mismatch will result in no data being received.
- **Incorrect Host Binding**: Setting the Syslog Host to `127.0.0.1` in Kibana will prevent the Agent from accepting external connections. Ensure it is set to `0.0.0.0` or the specific LAN IP.

## Ingestion Errors

- **Parsing Failures**: If logs appear in Discover but contain a `tags: ["_grokparsefailure"]` or similar error, verify that the **Format** selected on the Endace appliance (RFC 5424 vs RFC 3164) matches the expected format in the integration settings.
- **Timestamp Mismatches**: Ensure both the Endace appliance and the Elastic Agent host are synchronized to the same NTP server. Large clock drifts can cause logs to appear in the "past" or "future" in Kibana Discover.
- **Field Mapping Issues**: Check the `error.message` field in Kibana to see if specific fields are failing to map due to type conflicts (e.g., a field expected as a keyword but received as an object).

## Vendor Resources

- [Suricata Output and Logging Documentation](https://deepwiki.com/victorjulien/suricata/7-output-and-logging)
- Refer to the official vendor website for additional resources.

## Documentation sites

- [Suricata Output and Logging Documentation](https://deepwiki.com/victorjulien/suricata/7-output-and-logging)
- Refer to the official vendor website for product administration guides.
