# Service Info

The Cisco Nexus integration allows users to ingest, parse, and visualize logs from Cisco Nexus switches (NX-OS) within the Elastic Stack. This integration provides deep visibility into network operations, security events, and hardware status, enabling network administrators to monitor high-density data center environments effectively.

## Common use cases

The Cisco Nexus integration for Elastic Agent allows organizations to ingest, parse, and visualize system logs (syslog) generated by Cisco Nexus series switches. This visibility is essential for maintaining network health, security posture, and operational efficiency within data center environments.
- **Security Auditing and Compliance:** Monitor administrative access, configuration changes, and unauthorized login attempts to ensure compliance with security policies and regulatory requirements.
- **Network Performance Monitoring:** Track interface state changes (up/down), protocol flaps, and hardware-specific events to identify performance bottlenecks or physical layer issues before they impact services.
- **Proactive Troubleshooting:** Utilize real-time logging to detect system warnings and critical errors across the Nexus fabric, enabling rapid incident response and reducing Mean Time to Repair (MTTR).
- **Centralized Log Management:** Aggregating logs from multiple Nexus chassis into the Elastic Stack provides a single pane of glass for correlating network events with application and server telemetry.

## Data types collected

This integration can collect the following types of data:
- **System Logs (Syslog):** Standardized NX-OS system messages including severity levels 0 (Emergency) through 7 (Debug).
- **Authentication Logs:** Events related to SSH logins, TACACS+/RADIUS authentication attempts, and user privilege changes.
- **Hardware Events:** Messages regarding chassis health, module status, and environmental monitoring (temperature, voltage).
- **Network Protocol Logs:** Operational logs for STP, LACP, CDP, and various routing protocols.
- **Configuration Logs:** Audit trails of commands executed in global configuration mode (`configure terminal`).
- **Data Formats:** Logs are ingested via Syslog (RFC 3164 or RFC 5424) over UDP or TCP, typically formatted with the NX-OS specific mnemonic structure.

## Compatibility

The **Cisco Nexus** integration is compatible with the following:
- **Cisco Nexus 9000 Series** switches running NX-OS.
- **Cisco Nexus 7000, 5000, and 3000 Series** switches utilizing standard NX-OS syslog formats.
- Tested primarily on **NX-OS version 6.x and higher**, though older versions supporting standard RFC 5424/3164 syslog may function with minor parsing variations.

## Scaling and Performance

- **Transport/Collection Considerations:** For Cisco Nexus logging, the primary transport is Syslog over UDP or TCP. While UDP offers lower overhead and is less likely to impact switch performance, TCP provides reliable delivery. If using UDP, ensure the network path between the switch and the Elastic Agent has sufficient bandwidth and low congestion to prevent packet loss, which can lead to gaps in the log timeline.
- **Data Volume Management:** To manage log volume, configure the logging severity level on the Nexus switch. Setting the level to 5 (notifications) or 6 (informational) is recommended for production. Avoid level 7 (debugging) in high-traffic environments unless active troubleshooting is required, as this can generate massive amounts of data that may overwhelm the collection infrastructure or the switch's CPU.
- **Elastic Agent Scaling:** In high-density data center environments with hundreds of Nexus switches, a single Elastic Agent may become a bottleneck. It is recommended to deploy multiple Agents behind a load balancer to distribute the incoming Syslog traffic. Ensure that the host running the Elastic Agent has optimized kernel network buffers (e.g., `net.core.rmem_max` on Linux) to handle high-burst Syslog traffic.

# Set Up Instructions

## Vendor prerequisites

- **Administrative Access:** You must have `network-admin` or `vdc-admin` privileges to access the Command Line Interface (CLI) and modify logging configurations.
- **Network Connectivity:** Ensure the Cisco Nexus device can reach the Elastic Agent IP address over the configured syslog port (default is usually UDP 514 or 5514).
- **Firewall Rules:** Any intermediate firewalls or Access Control Lists (ACLs) must allow traffic from the Nexus management or loopback IP to the Elastic Agent on the specified port/protocol.
- **Feature License:** Ensure the basic NX-OS system management features are available (standard in all base licenses).
- **Time Synchronization:** It is highly recommended to have NTP configured on the Nexus switch to ensure log timestamps correlate accurately with the Elastic Stack.

## Elastic prerequisites

- **Elastic Agent:** An Elastic Agent must be installed on a host reachable by the Cisco Nexus switch and enrolled in Fleet.
- **Integration Policy:** The Cisco Nexus integration must be added to the Agent policy.
- **Network Configuration:** The host running the Elastic Agent must have its firewall configured to allow incoming traffic on the specified Syslog port (e.g., UDP/9001).

## Vendor set up steps

### For Syslog Collection (CLI):

1.  **Access the CLI:** Log into your Cisco Nexus device via SSH or Console and enter global configuration mode.
    ```bash
    configure terminal
    ```

2.  **Define the Elastic Agent as a Log Server:** Specify the IP address of your Elastic Agent and the desired severity level.
    *   Example for sending severity level 6 (Informational) and lower:
    ```bash
    logging server <elastic-agent-ip> 6
    ```

3.  **Configure Source Interface:** To ensure logs originate from a consistent IP, bind the logging process to a specific interface (e.g., mgmt0).
    ```bash
    logging source-interface mgmt0
    ```

4.  **Set Syslog Facility:** Assign a facility code to help categorize logs. The default is usually `local7`.
    ```bash
    logging facility local7
    ```

5.  **Enable Timestamps:** Ensure timestamps are accurate and include milliseconds if supported.
    ```bash
    logging timestamp milliseconds
    ```

6.  **Activate Logging:** Ensure the global logging process is enabled.
    ```bash
    logging on
    ```

7.  **Persist Changes:** Save the running configuration to the startup configuration.
    ```bash
    copy running-config startup-config
    ```

8.  **Verify Configuration:** Use the following command to verify the server is registered and the configuration is active.
    ```bash
    show logging server
    ```

## Kibana set up steps

1.  Navigate to **Management > Integrations** in Kibana.
2.  Search for **Cisco Nexus** and select the integration.
3.  Click **Add Cisco Nexus**.
4.  Select the **Agent Policy** to which you want to add this integration.
5.  In the integration settings, find the **Syslog** input section and configure the following:
    - **Syslog Host:** Set to `0.0.0.0` to listen on all interfaces or provide the specific IP of the Agent host.
    - **Syslog Port:** Set the port number (e.g., `9001`). This must match the port the switch is sending data to, or the port being forwarded to the Agent.
    - **Protocol:** Select `udp` (default for Cisco).
6.  Under **Advanced settings**, you may specify tags (e.g., `datacenter-east`) to help filter logs later.
7.  Click **Save and continue** and then **Roll out changes** to deploy the configuration to your Elastic Agents.

# Validation Steps

After configuration is complete, follow these steps to verify data is flowing correctly from Cisco Nexus to the Elastic Stack.

### 1. Trigger Data Flow on Cisco Nexus:
- **Generate configuration event:** Enter configuration mode and exit to trigger an accounting/audit log:
  ```bash
  conf t
  exit
  ```
- **Trigger interface event:** Perform a shutdown and no shutdown on a non-production or test interface to generate state change logs:
  ```bash
  interface eth1/1
  shutdown
  no shutdown
  ```
- **Generate authentication event:** Log out of the current SSH session and log back in to generate an authentication/session event.

### 2. Check Data in Kibana:
1. Navigate to **Analytics > Discover**.
2. Select the `logs-*` data view or the specific integration data view.
3. Enter the following KQL filter: `data_stream.dataset : "cisco_nexus.log"`
4. Verify logs appear in the results. Expand a log entry and confirm these fields are populated:
   - `event.dataset` (should be `cisco_nexus.log`)
   - `source.ip` (should be the IP of your Nexus switch)
   - `log.syslog.priority` or `log.syslog.severity.code`
   - `cisco.nexus.mnemonic` (e.g., `IF_UP`, `IF_DOWN`, or `VSHD_SYSLOG_CONFIG_I`)
   - `message` (containing the raw log payload from NX-OS)
5. Navigate to **Analytics > Dashboards** and search for "Cisco Nexus" to view pre-built visualizations.

# Troubleshooting

## Common Configuration Issues

- **VRF Reachability**: If the switch is configured to use the `management` VRF but the Elastic Agent is on a data VLAN, the logs will not reach the destination. Ensure the `use-vrf` parameter in the `logging server` command matches the routing table that has a path to the Agent.
- **Timestamp Mismatch**: If logs appear with incorrect dates or times in Kibana, ensure `logging timestamp milliseconds` is configured on the Nexus switch and that NTP is synchronized across the network.
- **Firewall Obstructions**: Often, local server firewalls (iptables/firewalld) or intermediate network firewalls block UDP port 514 or 9001. Use `tcpdump -i any udp port 9001` on the Agent host to verify if packets are arriving.
- **Logging Level too Low**: If expected events (like interface changes) are not appearing, check if the `logging server` severity is set too high (e.g., 0-3). Lower the threshold to 5 or 6 to see more granular events.

## Ingestion Errors

- **Parsing Failures**: If the `error.message` field in Discover indicates parsing issues, verify that the Cisco Nexus switch is using the default NX-OS log format. Custom syslog headers added by intermediate syslog relays can break the integration's grok patterns.
- **Format Mismatches**: Ensure the switch is not configured for a non-standard syslog format. The integration expects the standard `%FACILITY-SEVERITY-MNEMONIC: message` pattern common to NX-OS.
- **Field Mapping**: If `source.ip` is showing the IP of a syslog proxy instead of the switch, check the `logging source-interface` configuration on the Nexus device to ensure it is sending directly to the Elastic Agent.

## Vendor Resources

- [Cisco Nexus 5000 Series NX-OS Software Configuration Guide - Configuring System Message Logging](https://www.cisco.com/c/en/us/td/docs/switches/datacenter/nexus5000/sw/configuration/guide/cli/CLIConfigurationGuide/sm_syslog.html)
- [Cisco Nexus 7000 Series NX-OS System Management Configuration Guide, Release 5.x - Configuring System Message Logging](https://www.cisco.com/c/en/us/td/docs/switches/datacenter/sw/5_x/nx-os/system_management/configuration/guide/sm_nx_os_cg/sm_5syslog.html)

# Documentation sites

- [Cisco Nexus 9000 Series NX-OS System Management Configuration Guide](https://www.cisco.com/c/en/us/td/docs/switches/datacenter/nexus9000/sw/6-x/system_management/configuration/guide/b_Cisco_Nexus_9000_Series_NX-OS_System_Management_Configuration_Guide/sm_5syslog.html)
- [Logging > NX-OS Troubleshooting Tools | Cisco Press](https://www.ciscopress.com/articles/article.asp?p=2928194&seqNum=6)
- Refer to the official vendor website for additional resources.
