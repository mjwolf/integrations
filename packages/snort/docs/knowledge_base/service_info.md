# Service Info

## Common use cases

*   **Intrusion Detection and Prevention**: Detect and alert on network-based attacks, including buffer overflows, stealth port scans, and CGI attacks, by monitoring real-time traffic.
*   **Centralized Security Auditing**: Aggregate alerts from multiple Snort sensors across a distributed network into the Elastic Stack for unified security analysis and incident response.
*   **Compliance Monitoring**: Maintain long-term records of network security events to meet regulatory requirements for network visibility and threat detection.

## Data types collected

*   **Logs**: Security alerts and event data generated by the Snort engine, including rule signatures, source/destination IP addresses, and protocol metadata.

## Compatibility

*   **Snort Versions**: Compatible with Snort 2.9.x and Snort 3.x.
*   **Operating Systems**: Modern Linux distributions including Debian, Ubuntu, and CentOS/RHEL with `rsyslog` installed.

## Scaling and Performance

*   **Protocol Selection**: Use TCP (`@@`) in rsyslog for guaranteed delivery in high-volume environments; use UDP (`@`) for lower overhead if occasional packet loss is acceptable.
*   **Resource Management**: For high-throughput environments, consider adjusting the `rsyslog` main message queue size to prevent bottlenecks during burst traffic.

# Set Up Instructions

## Vendor prerequisites

*   Snort must be installed and running on the target system.
*   Root or `sudo` administrative privileges are required to modify configuration files and restart services.
*   `rsyslog` service must be installed and active for log forwarding.

## Elastic prerequisites

*   Elastic Agent must be installed on a host reachable by the Snort sensor.
*   The Snort integration must be added to an Elastic Agent policy.
*   A Syslog input must be configured in the integration settings with a designated port (e.g., 514 or 9514).

## Vendor set up steps

1.  **Configure Snort for Syslog Output**:
    *   Open `/etc/snort/snort.conf` (or your specific path).
    *   Add or uncomment the following line in the output plugins section:
        ```text
        output alert_syslog: LOG_AUTH LOG_ALERT
        ```
    *   Save the file and restart Snort: `sudo systemctl restart snort`.

2.  **Configure Rsyslog Forwarding**:
    *   Create a forwarding configuration file: `sudo nano /etc/rsyslog.d/60-forward-snort.conf`.
    *   Add the following forwarding rule (replace placeholders with your Elastic Agent details):
        ```text
        *.* @@<elastic-agent-ip>:<port>
        ```
    *   Save and exit the editor.

3.  **Restart Logging Services**:
    *   Apply changes by restarting rsyslog: `sudo systemctl restart rsyslog`.

## Kibana set up steps

1.  Log in to Kibana and navigate to **Management > Integrations**.
2.  Search for and select the **Snort** integration.
3.  Click **Add Snort**.
4.  Configure the **Syslog Host** and **Syslog Port** to match the values used in your rsyslog configuration.
5.  Select the **Existing Host Policy** where your Elastic Agent is enrolled.
6.  Click **Save and continue**.

# Validation Steps

1.  **Generate a Test Log**: Run the command `logger "This is a test message from Snort host"` on the Snort machine.
2.  **Verify Flow in Kibana**: Navigate to **Observability > Logs** or **Discover** and search for `event.dataset : "snort.log"`.
3.  **Check Service Status**: Ensure Snort is actively processing traffic by running `sudo systemctl status snort`.
4.  **Network Connectivity**: Use `tcpdump` or `nc -v <elastic-agent-ip> <port>` to verify the Snort host can reach the Elastic Agent.

# Troubleshooting

## Common Configuration Issues

*   **Port Mismatch**: Ensure the port defined in `/etc/rsyslog.d/60-forward-snort.conf` exactly matches the port configured in the Kibana integration settings.
*   **Firewall Blocks**: Verify that local firewalls (e.g., `ufw` or `firewalld`) and network ACLs allow traffic on the configured syslog port.
*   **Permission Denied**: Ensure the user running Snort has permissions to write to the system log or that the `alert_syslog` plugin is properly initialized.

## Ingestion Errors

*   **Parsing Failures**: If logs appear in Kibana but fields are not correctly mapped, verify that the syslog format in `rsyslog` hasn't been modified from the default template.
*   **Incorrect Facility**: Using facilities other than `LOG_AUTH` or `LOG_DAEMON` may cause some rsyslog configurations to ignore the alerts; verify the `snort.conf` output settings.

## API Authentication Errors

*   **Not specified**: This integration relies on syslog forwarding rather than direct API authentication from the vendor. Ensure the Elastic Agent itself has a valid API key to communicate with Fleet.

## Vendor Resources

*   [Snort Documentation - Official Guides](https://www.snort.org/documents)
*   [Snort Support and Community FAQ](https://www.snort.org/faq)
*   [Rsyslog Troubleshooting Guide](https://www.rsyslog.com/doc/v8-stable/troubleshooting/index.html)

# Documentation sites

*   [Snort Product Overview](https://www.snort.org/)
*   [Elastic Integration for Snort](https://docs.elastic.co/integrations/snort)
*   [Installing and Configuring NIDS with Snort](https://dohost.us/index.php/2025/08/29/installing-and-configuring-a-network-based-ids-nids-with-snort/)