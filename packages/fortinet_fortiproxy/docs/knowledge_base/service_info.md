# Service Info

## Common use cases

*   **Security Threat Detection:** Monitor traffic logs to identify malware infections, unauthorized access attempts, and potential data exfiltration through the web proxy.
*   **Web Activity Auditing:** Track user web browsing behavior and policy compliance by analyzing web filter and traffic logs forwarded to Elastic.
*   **System Health Monitoring:** Monitor administrative activities and system events to ensure the stability and integrity of the FortiProxy appliance.

## Data types collected

This integration primarily collects log data, including traffic logs, system event logs, and security-specific logs (e.g., web filter, antivirus). Data can be formatted as CEF (Common Event Format), CSV, or the default Fortinet log format.

## Compatibility

This integration is compatible with FortiProxy versions supporting remote syslog export, specifically tested and documented for version 7.6.2. It supports standard syslog transport over UDP or TCP.

## Scaling and Performance

Scaling and performance depend on the FortiProxy hardware model or VM specifications and the volume of traffic processed. Users should ensure the Elastic Agent is provisioned with sufficient resources to handle the peak log throughput generated by the proxy.

# Set Up Instructions

## Vendor prerequisites

*   Administrative access to the FortiProxy Command Line Interface (CLI) via SSH or console.
*   A valid FortiProxy license enabling logging features.
*   Network connectivity between the FortiProxy device and the Elastic Agent host.

## Elastic prerequisites

*   Elastic Agent must be installed and enrolled in a policy.
*   The "Custom Syslog" or "Fortinet" integration must be added to the Elastic Agent policy.
*   Ensure the host firewall allows incoming traffic on the configured syslog port (default is 514).

## Vendor set up steps

1.  **Access the CLI:** Connect to the FortiProxy device using SSH or a console connection.
2.  **Configure Syslog Settings:**
    ```bash
    config log syslogd setting
    set status enable
    set server <elastic_agent_ip>
    set format cef
    set port 514
    end
    ```
3.  **Configure Log Filtering:**
    ```bash
    config log syslogd filter
    set severity information
    set forward-traffic enable
    set local-traffic enable
    end
    ```
4.  Verify that the proxy can reach the Elastic Agent IP over the specified port.

## Kibana set up steps

1.  Log in to Kibana and navigate to **Management > Integrations**.
2.  Search for and select the **Fortinet** integration (or use a Custom Syslog integration).
3.  Click **Add Fortinet** and configure the integration name and description.
4.  Under the **Syslog** settings, specify the **Listen Port** (e.g., 514) and **Protocol** matching your FortiProxy configuration.
5.  Select the **Existing hosts** tab and choose the agent policy applied to your collector.
6.  Click **Save and continue**.

# Validation Steps

1.  **Check Data Ingestion:** Navigate to **Kibana > Discover** and filter by `event.module: fortinet` or `data_stream.dataset: fortinet.fortiproxy`.
2.  **Verify Syslog Connectivity:** Run `tcpdump -i any port 514` on the Elastic Agent host to confirm packets are arriving from the FortiProxy IP.
3.  **Trigger Test Events:** Generate web traffic through the FortiProxy or perform a configuration change to trigger a system event log.

# Troubleshooting

## Common Configuration Issues

*   **Connectivity Issues:** Ensure that there are no intermediate firewalls blocking the syslog port (UDP/TCP 514) between FortiProxy and the Elastic Agent.
*   **Logs Not Sent:** Verify that the syslog status is set to `enable` and that the filter severity is set low enough (e.g., `information` or `debug`) to capture the desired events.

## Ingestion Errors

*   **Parsing Failures:** If logs appear in Elastic but fields are not mapped, ensure the `set format` in FortiProxy matches the expected format in the Elastic integration (CEF is generally recommended for better field mapping).
*   **Timezone Mismatch:** Check that the FortiProxy system time is synchronized via NTP to avoid timestamp offsets in Kibana.

## API Authentication Errors

Not specified. FortiProxy syslog forwarding uses standard protocol transmission and does not typically utilize API-based authentication for log delivery.

## Vendor Resources

*   [FortiProxy Log Settings Documentation](https://docs.fortinet.com/document/fortiproxy/7.6.2/administration-guide/250999/log-settings)
*   [Fortinet Support Portal](https://support.fortinet.com/)
*   [FortiProxy Troubleshooting Guide](https://docs.fortinet.com/document/fortiproxy/7.6.2/administration-guide/464816/troubleshooting)

# Documentation sites

*   [FortiProxy Product Overview](https://www.fortinet.com/products/web-proxy)
*   [FortiProxy 7.6.2 Administration Guide](https://docs.fortinet.com/document/fortiproxy/7.6.2/administration-guide/)
*   [Elastic Integration for Fortinet](https://docs.elastic.co/en/integrations/fortinet)